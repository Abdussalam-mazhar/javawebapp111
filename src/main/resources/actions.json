{
  "QuickCommands": [
    {
      "command": ["/start"],
      "ProcName": "Start"
    },
    {
      "command": ["/help"],
      "ProcName": "ShowHelp"
    },
    {
      "command": ["/new"],
      "ProcName": "PlayerSetup"
    },
    {
      "command": ["/me"],
      "ProcName": "ShowCharacterInfo"
    },
    {
      "command": ["/village", "The Village", "Village Square"],
      "ProcName": "Goto",
      "ParamMappings": {
        "NewLocation": "The Village"
      }
    },
    {
      "command": ["The Inn"],
      "ProcName": "Goto",
      "ParamMappings": {
        "NewLocation": "The Inn"
      }
    },
    {
      "command": ["Retrieve Items"],
      "ProcName": "Retrieve Items"
    },
    {
      "command": ["Short Rest"],
      "ProcName": "Short Rest"
    },
    {
      "command": ["The Tavern"],
      "ProcName": "Goto",
      "ParamMappings": {
        "NewLocation": "The Tavern"
      }
    },
    {
      "command": ["/mountain", "The Mountain"],
      "ProcName": "Goto",
      "ParamMappings": {
        "NewLocation": "The Mountain"
      }
    },
    {
      "command": ["/woodlands", "The Woodlands"],
      "ProcName": "Goto",
      "ParamMappings": {
        "NewLocation": "The Woodlands"
      }
    }
  ],
  "Packages": [
    {
      "Name": "core",
      "actions": [
        {
          "name": "Start",
          "steps": [
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "SetupComplete",
                "AttributeValue": "false"
              }
            },
            {
              "ProcName": "PlayerSetup"
            }
          ]
        },
        {
          "name": "ShowHelp",
          "steps": [
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "The following commands are available:\n* /new - create a new character\n* /help - show this help info\n* /me - show your character information.\n\nYour chat ID is ${chatId}"
              }
            }
          ]
        },
        {
          "name": "Echo",
          "steps": [
            {
              "ProcName": "Native:SendMessage",
              "ParamMappings": {
                "Message": "${MessageToPrint}"
              }
            }
          ]
        },
        {
          "name": "SetPlayerAttribute",
          "steps": [
            {
              "ProcName": "Native:SetVar",
              "ParamMappings": {
                "VarSet": "__Player",
                "VarName": "${AttributeName}",
                "VarValue": "${AttributeValue}"
              }
            }
          ]
        },
        {
          "name": "SetPlayerHP",
          "steps": [
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "HP",
                "AttributeValue": "eval(${NewHP}<${Player.MaxHP})"
              }
            }
          ]
        },
        {
          "name": "Goto",
          "requires": {
            "condition": "${Player.SetupComplete}==true",
            "steps": [
              {
                "ProcName": "SetPlayerAttribute",
                "ParamMappings": {
                  "AttributeName": "Location",
                  "AttributeValue": "${NewLocation}"
                }
              },
              {
                "ProcName": "Echo",
                "ParamMappings": {
                  "MessageToPrint": "You are now at ${Player.Location}"
                }
              },
              {
                "ProcName": "${Player.Location} Menu"
              }
            ],
            "or-else": {
              "steps": [
                {
                  "ProcName": "NoCharacterCreatedError"
                }
              ]
            }
          }
        },
        {
          "name": "ShowCharacterInfo",
          "steps": [
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "${Player.Name} (${Player.Class} - L${Player.Level})\nLocation: ${Player.Location}\n\n❤️: ${Player.HP} / ${Player.MaxHP}\n✨: ${Player.Mana} / ${Player.MaxMana}\nStrength: ${Player.Strength}\nAgility: ${Player.Agility}\nConstitution: ${Player.Constitution}\nCarrying:\n• ${Player.Item.Carrying.Left} ${weapons.${Player.Item.Carrying.Left}.icon}${weapons.${Player.Item.Carrying.Left}.damage}\n• ${Player.Item.Carrying.Right}"
              }
            }
          ]
        },
        {
          "name": "NoCharacterCreatedError",
          "steps": [
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "You need to create a character first. Please use /new"
              }
            }
          ]
        }
      ]
    },
    {
      "Name": "setup",
      "actions": [
        {
          "name": "PlayerSetup",
          "requires": {
            "condition": "${Player.SetupComplete}==false",
            "steps": [
              {
                "ProcName": "ReadPlayerName"
              },
              {
                "ProcName": "ReadPlayerClass"
              },
              {
                "ProcName": "InitCharacterStats"
              },
              {
                "ProcName": "SetPlayerAttribute",
                "ParamMappings": {
                  "AttributeName": "SetupComplete",
                  "AttributeValue": "true"
                }
              },
              {
                "ProcName": "Echo",
                "ParamMappings": {
                  "MessageToPrint": "Welcome, ${Player.Name} the ${Player.Class}!"
                }
              },
              {
                "ProcName": "Goto",
                "ParamMappings": {
                  "NewLocation": "The Village"
                }
              }
            ],
            "or-else": {
              "steps": [
                {
                  "ProcName": "Echo",
                  "ParamMappings": {
                    "MessageToPrint": "You already have an active character - you're ${Player.Name} the ${Player.Class}"
                  }
                }
              ]
            }
          }
        },
        {
          "name": "ReadPlayerName",
          "steps": [
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "By what name will you be known?"
              }
            },
            {
              "ProcName": "Native:ReadTextInput",
              "OutputMappings": {
                "CapturedText": "CharacterName"
              }
            },
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "Very well. So shall you be known."
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Name",
                "AttributeValue": "${CharacterName}"
              }
            }
          ]
        },
        {
          "name": "ReadPlayerClass",
          "steps": [
            {
              "ProcName": "Native:ReadOption",
              "ParamMappings": {
                "MessageToPrint": "Please choose your player class",
                "Options": "General,Trickster,Explorer,Brawler,Wizard,Druid"
              },
              "OutputMappings": {
                "ChosenOption": "Class"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Class",
                "AttributeValue": "${Class}"
              }
            }
          ]
        },
        {
          "name": "InitCharacterStats",
          "steps": [
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Level",
                "AttributeValue": "1"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "MaxHP",
                "AttributeValue": "${classes.${Player.Class}.initial-hit-points}"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "HP",
                "AttributeValue": "${Player.MaxHP}"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Constitution",
                "AttributeValue": "${classes.${Player.Class}.initial-constitution}"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Strength",
                "AttributeValue": "${classes.${Player.Class}.initial-strength}"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Agility",
                "AttributeValue": "${classes.${Player.Class}.initial-agility}"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Mana",
                "AttributeValue": "2"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "MaxMana",
                "AttributeValue": "3"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Item.Carrying.Left",
                "AttributeValue": "nothing"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Item.Carrying.Right",
                "AttributeValue": "nothing"
              }
            }
          ]
        }
      ]
    },
    {
      "Name": "Village",
      "actions": [
        {
          "name": "The Village Menu",
          "steps": [
            {
              "ProcName": "Native:Menu",
              "ParamMappings": {
                "MessageToPrint": "The bustle of the village square brings a reassuring comfort to weary adventurers - the only danger here is the prices charged by the local bartender.\n\nThe square is dominated on the one side by the local tavern, from which you hear loud music and occasional raised voices.\n\nFacing it, within stumbling range, is the Inn. The innkeeper is a friend, and has offered to look after any items you may wish to leave behind while you're out on your adventures.\n\nTo the north lies a path leading up to The Mountain, and another leading out to the Woodlands.",
                "Options": "The Inn,The Tavern,The Mountain,The Woodlands"
              }
            }
          ]
        },
        {
          "name": "The Inn Menu",
          "steps": [
            {
              "ProcName": "Native:Menu",
              "ParamMappings": {
                "MessageToPrint": "This is the inn",
                "Options": "Leave Items,Retrieve Items,Short Rest,Village Square"
              }
            }
          ]
        },
        {
          "name": "Retrieve Items",
          "steps": [
            {
              "ProcName": "Native:SpawnItem",
              "OutputMappings": {
                "SpawnedItem": "SpawnedItem"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "Item.Carrying.Left",
                "AttributeValue": "${SpawnedItem}"
              }
            }
          ]
        },
        {
          "name": "Short Rest",
          "steps": [
            {
              "ProcName": "Native:QueueAction",
              "ParamMappings": {
                "delay": "10s",
                "ProcName": "DoShortRest"
              }
            },
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "You're resting."
              }
            }
          ]
        },
        {
          "name": "DoShortRest",
          "steps": [
            {
              "ProcName": "RollShortRest",
              "OutputMappings": {
                "HPRecovered": "HPRested"
              }
            },
            {
              "ProcName": "SetPlayerAttribute",
              "ParamMappings": {
                "AttributeName": "HP",
                "AttributeValue": "eval(${Player.HP} + ${HPRecovered})"
              }
            },
            {
              "ProcName": "Echo",
              "ParamMappings": {
                "MessageToPrint": "You rested and recovered ❤️${HPRecovered}. Now at ${Player.HP} of ${Player.MaxHP}"
              }
            }
          ]
        },
        {
          "name": "RollShortRest",
          "steps": [
            {
              "ProcName": "Native:SetVar",
              "ParamMappings": {
                "VarSet": "",
                "VarName": "tmp",
                "VarValue": "eval(((${Player.HP} + ((${Player.Level}d${classes.${Player.Class}.short-rest-dice}) + floor((${Player.Constitution} - 10)/2)))<${Player.MaxHP}) - ${Player.HP})"
              },
              "OutputMappings": {
                "tmp": "HPRecovered"
              }
            }
          ]
        },
        {
          "name": "The Tavern Menu",
          "steps": [
            {
              "ProcName": "Native:Menu",
              "ParamMappings": {
                "MessageToPrint": "This is the tavern",
                "Options": "Village Square,Buy Drinks"
              }
            }
          ]
        },
        {
          "name": "Buy Drinks",
          "requires": {
            "condition": "chance(33.333%)",
            "steps": [
              {
                "ProcName": "Echo",
                "ParamMappings": {
                  "MessageToPrint": "Aaah, a nice cold beer. Just what the druid ordered."
                }
              }
            ],
            "or-else": {
              "steps": [
                {
                  "ProcName": "Echo",
                  "ParamMappings": {
                    "MessageToPrint": "You don't know what the drink is the barman puts down in front of you, but it doesn't look good. You drink it anyway.. you don't feel good."
                  }
                },
                {
                  "ProcName": "SetPlayerHP",
                  "ParamMappings": {
                    "NewHP": "eval((${Player.HP}-1)>0)"
                  }
                }
              ]
            }
          }
        }
      ]
    },
    {
      "Name": "Mountain",
      "actions": [
        {
          "name": "The Mountain Menu",
          "steps": [
            {
              "ProcName": "Native:Menu",
              "ParamMappings": {
                "MessageToPrint": "This is the mountain...",
                "Options": "The Village"
              }
            }
          ]
        }
      ]
    },
    {
      "Name": "Woodlands",
      "actions": [
        {
          "name": "The Woodlands Menu",
          "steps": [
            {
              "ProcName": "Native:Menu",
              "ParamMappings": {
                "MessageToPrint": "This is the Woodlands...",
                "Options": "The Village,Deeper"
              }
            }
          ]
        }
      ]
    }
  ]
}
